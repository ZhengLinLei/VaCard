var closeShadow,closeDelete,settingPush,DataCards;const NameLocal_=btoa("data-card"),getBase64FromUrl=async e=>{const a=await fetch(e),t=await a.blob();return new Promise((e=>{const a=new FileReader;a.readAsDataURL(t),a.onloadend=()=>{const t=a.result;e(t)}}))};localStorage.getItem(NameLocal_)||localStorage.setItem(NameLocal_,btoa("[]")),window.addEventListener("load",(()=>{window.addEventListener("appinstalled",(e=>{localStorage.setItem("pwa_installed",1)})),localStorage.getItem("cookies")||(localStorage.setItem("cookies",1),document.getElementById("cookies").classList.add("open"),setTimeout((()=>{document.getElementById("cookies").classList.remove("open")}),18e4)),settingPush=()=>{document.querySelector("#setting").classList.toggle("open")},DataCards={data:JSON.parse(atob(localStorage.getItem(NameLocal_))),saveCardDataToSto:()=>{localStorage.setItem(NameLocal_,btoa(JSON.stringify(DataCards.data)))},htmlCardMaker:(e,a)=>{const t=["primary","secondary","danger","dark","info","success","warning","muted","white"],r=t[Math.floor(Math.random()*t.length)];return`<div class="column col-12 col-md-6">\n                        <a class="btn btn-${r} shadow-sm d-flex justify-content-center align-items-center card-info" data-color="${r}" id="card-${e}" onclick="DataCards.openCardQr(this)" data-index="${e}">\n                            <h4>${a.name}</h4>\n                        </a>\n                    </div>`},updateUI:e=>{e.innerHTML="",DataCards.data.forEach(((a,t)=>{let r=DataCards.htmlCardMaker(t,a);e.innerHTML+=r}))},openCardQr:e=>{let t=e.getAttribute("data-index");a.classList.add("open"),r.classList.add("open"),r.querySelector("#qrImg").src=DataCards.data[t].qr64,r.querySelector("#qrName").innerHTML=DataCards.data[t].name,r.querySelector("#qrDate").innerHTML=new Date(1e3*DataCards.data[t].date).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric"}),r.querySelector("#qrDelete").onclick=()=>DataCards.openDeleteUI(t)},openDeleteUI:e=>{o.querySelector("#deleteName").innerHTML=DataCards.data[e].name,o.querySelector("#deleteColor").className=`bg-${document.querySelector(`#card-${e}`).getAttribute("data-color")}`,o.querySelector("#confirmDelete").onclick=()=>DataCards.deleteCard(e),o.classList.add("open")},deleteCard:a=>{DataCards.data.splice(a,1),DataCards.saveCardDataToSto(),DataCards.updateUI(e),closeShadow()},searchPush:async(a,t=3)=>{let r=0;for(;r<=t;){try{let t=await fetch("http://api.qrserver.com/v1/read-qr-code/",{method:"POST",body:a});if(t=await t.json(),t[0].symbol[0].data){let a=`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${t[0].symbol[0].data}`;getBase64FromUrl(a).then((a=>{let r={name:n.value,date:parseInt((new Date(s.value).getTime()/1e3).toFixed(0)),hash:t[0].symbol[0].data,qr64:a};DataCards.data.push(r),DataCards.saveCardDataToSto(),DataCards.updateUI(e),i(),closeShadow(),document.getElementById("loader").classList.remove("open")}))}else c.innerHTML=t[0].symbol[0].error,document.getElementById("loader").classList.remove("open");return 0}catch(e){r==t&&(navigator.onLine?c.innerHTML="Try again":c.innerHTML="Internet error",document.getElementById("loader").classList.remove("open"))}r++}}},closeShadow=()=>{[a,t,r,o].forEach((e=>e.classList.remove("open")))},closeDelete=()=>{o.classList.remove("open")};let e=document.querySelector("#cardList");DataCards.updateUI(e);let a=document.querySelector(".shadow"),t=document.querySelector("#addNew"),r=document.querySelector("#QRsection"),o=document.querySelector("#alertDelete"),d=document.querySelector("#submitCard");a.addEventListener("click",closeShadow),document.getElementById("add").addEventListener("click",(e=>{a.classList.add("open"),t.classList.add("open")}));let n=document.querySelector("#nameInput"),s=document.querySelector("#vaxDate"),l=document.querySelector("#qrCode"),c=document.querySelector("#errorSubmit");function i(){n.value="",s.value="";try{l.value=""}catch(e){}if(l.value){var e=document.createElement("form"),a=l.parentNode,t=l.nextSibling;e.appendChild(l),e.reset(),a.insertBefore(l,t)}}l.addEventListener("input",(()=>{var e=l.value.replace(/^.*?([^\\\/]*)$/,"$1");document.getElementById("fileName").innerHTML=e.length>=10?e.substring(0,7)+"...":e,c.innerHTML=""})),d.addEventListener("submit",(e=>{if(e.preventDefault(),n.value&&s.value&&l.files){const e=new FormData;e.append("file",l.files[0]),document.getElementById("loader").classList.add("open"),DataCards.searchPush(e)}}))}));